<!DOCTYPE html>
<html>
<head>
  <title>QR Code Scanner</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
  <h1>Scan QR Code</h1>
  <div id="reader" style="width: 300px;"></div>
  <p id="result"></p>

  <script>
    const sheetUrl = "https://script.google.com/macros/s/AKfycbx3Qsh3VXzfm-JyXr0nsooX3QFUSiXFUhiaNKqU7I8VCOedXtwcCdQLCHr6OpEB-6uE/exec"; // paste new Apps Script Web App URL here

    function postToSheet(qrData) {
      fetch(sheetUrl, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ qrData: qrData })
      })
      .then(response => response.json())
      .then(data => {
        console.log("Posted to sheet:", data);
        document.getElementById("result").innerText = "Posted: " + qrData;
      })
      .catch(error => {
        console.error("Error posting to Sheets:", error);
        document.getElementById("result").innerText = "Error: " + error;
      });
    }

    function onScanSuccess(decodedText, decodedResult) {
      console.log(`QR matched = ${decodedText}`);
      postToSheet(decodedText);
    }

    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      { facingMode: "environment" },
      {
        fps: 10,
        qrbox: { width: 250, height: 250 }
      },
      onScanSuccess
    ).catch(err => {
      console.error("Error starting QR scanner", err);
    });
  </script>
</body>
</html>
