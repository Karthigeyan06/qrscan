<!DOCTYPE html>
<html>
<head>
  <title>QR Image Upload to Google Sheets</title>
  <script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
</head>
<body>
  <h2>Select QR Code Image</h2>

  <input type="file" accept="image/*" id="qr-file" />
  <p id="result">Waiting for image...</p>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbxAYhGzV-2V_S-KSAMM8isrYscsIhTRY3D6dQUgcGekA6iJMNbXy7NfGPGnNacFjHmQ/exec"; // üîÅ Replace with your Google Apps Script URL

    document.getElementById("qr-file").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function() {
        const imgDataUrl = reader.result;

        const qrScanner = new Html5Qrcode("reader-dummy"); // Dummy element
        qrScanner.scanFile(file, true)
          .then(decodedText => {
            document.getElementById("result").innerText = "‚úÖ QR: " + decodedText;
            // POST to Google Sheets
            fetch(scriptURL, {
              method: 'POST',
              body: JSON.stringify({ qr: decodedText }),
              headers: { 'Content-Type': 'application/json' }
            })
            .then(() => document.getElementById("result").innerText += " ‚Üí Sent to Sheet")
            .catch(err => document.getElementById("result").innerText += " ‚ùå POST Error");
          })
          .catch(err => {
            document.getElementById("result").innerText = "‚ùå QR Code not detected in image.";
          });
      };
      reader.readAsDataURL(file);
    });
  </script>

  <!-- Dummy div (needed by html5-qrcode lib, even if hidden) -->
  <div id="reader-dummy" style="display:none;"></div>
</body>
</html>
