<!DOCTYPE html>
<html>
<head>
  <title>QR Code Scanner</title>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
</head>
<body>
  <h1>QR Code Scanner</h1>
  <div id="reader" style="width:300px;"></div>
  <p id="output"></p>

  <script>
    const sheetURL ="https://script.google.com/macros/s/AKfycbx6RlkQ8khH3L8A3M_E9Y5ghMbRvxMZNRigh-9tZMcuN8PltWYovt5Fb1xNCWJcDNkT/exec";

    function onScanSuccess(qrMessage) {
      document.getElementById("output").innerText = `Scanned: ${qrMessage}`;
      sendToSheet(qrMessage);
    }

    function sendToSheet(scannedText) {
      fetch(sheetURL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ scannedText: scannedText })
      })
      .then((res) => res.json())
      .then((data) => {
        console.log("✅ Posted to sheet:", data);
      })
      .catch((err) => {
        console.error("❌ Error posting to sheet:", err);
      });
    }

    const html5QrCode = new Html5Qrcode("reader");

    Html5Qrcode.getCameras().then((devices) => {
      if (devices && devices.length) {
        html5QrCode.start(
          { facingMode: "environment" }, // back camera
          {
            fps: 10,
            qrbox: 250,
          },
          onScanSuccess
        );
      }
    }).catch(err => {
      console.error("Camera error:", err);
    });
  </script>
</body>
</html>
